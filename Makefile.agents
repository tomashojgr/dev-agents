# dev-agents commands
# Included automatically by Installer into project Makefile

AGENTS_BIN := vendor/bin
DA_PHP_CMD ?= php

# ── Task management ───────────────────────────────────────────────────────────

.PHONY: da-spec
da-spec: ## Create task specification. Usage: make da-spec TASK="add DKIM validation"
	@test -n "$(TASK)" || (echo '❌ TASK is required. Usage: make da-spec TASK="add DKIM validation"' && exit 1)
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-spec "$(TASK)"

.PHONY: da-approve
da-approve: ## Approve task specification. Usage: make da-approve TASK=task-001-dkim-validation
	@test -n "$(TASK)" || (echo '❌ TASK is required. Usage: make da-approve TASK=task-001-dkim-validation' && exit 1)
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-approve "$(TASK)"

.PHONY: da-code
da-code: ## Start implementation of approved task. Usage: make da-code TASK=task-001-dkim-validation
	@test -n "$(TASK)" || (echo '❌ TASK is required. Usage: make da-code TASK=task-001-dkim-validation' && exit 1)
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-code "$(TASK)"

.PHONY: da-commit
da-commit: ## Run commit agent. Usage: make da-commit TASK=task-001-dkim-validation
	@test -n "$(TASK)" || (echo '❌ TASK is required. Usage: make da-commit TASK=task-001-dkim-validation' && exit 1)
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-commit "$(TASK)"

.PHONY: da-lint
da-lint: ## Run lint agent.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-lint

.PHONY: da-lint-fix
da-lint-fix: ## Run linters and launch Claude Code to fix issues interactively.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-lint --save-prompt .dev-agents-lint || claude "$$(cat .dev-agents-lint)"

.PHONY: da-release
da-release: ## Run release agent.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-release

# ── Help ──────────────────────────────────────────────────────────────────────

.PHONY: da-help
da-help: ## Show dev-agents commands
	@echo ""
	@echo "dev-agents commands:"
	@grep -hE '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-12s\033[0m %s\n", $$1, $$2}'
	@echo ""
