# dev-agents commands
# Included automatically by Installer into project Makefile

AGENTS_BIN := vendor/bin
DA_PHP_CMD ?= php

# ── Task management ───────────────────────────────────────────────────────────

.PHONY: spec
spec: ## Create task specification. Usage: make spec TASK="add DKIM validation"
ifndef TASK
	$(error TASK is required. Usage: make spec TASK="add DKIM validation")
endif
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-spec "$(TASK)"

.PHONY: approve
approve: ## Approve task specification. Usage: make approve TASK=task-001-dkim-validation
ifndef TASK
	$(error TASK is required. Usage: make approve TASK=task-001-dkim-validation)
endif
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-approve "$(TASK)"

.PHONY: code
code: ## Start implementation of approved task. Usage: make code TASK=task-001-dkim-validation
ifndef TASK
	$(error TASK is required. Usage: make code TASK=task-001-dkim-validation)
endif
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-code "$(TASK)"

# ── Agents ────────────────────────────────────────────────────────────────────

.PHONY: commit
commit: ## Run commit agent. Usage: make commit TASK=task-001-dkim-validation
ifndef TASK
	$(error TASK is required. Usage: make commit TASK=task-001-dkim-validation)
endif
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-commit "$(TASK)"

.PHONY: lint
lint: ## Run lint agent.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-lint

.PHONY: lint-fix
lint-fix: ## Run linters and launch Claude Code to fix issues interactively.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-lint-fix

.PHONY: release
release: ## Run release agent.
	$(DA_PHP_CMD) $(AGENTS_BIN)/da-release

# ── Help ──────────────────────────────────────────────────────────────────────

.PHONY: da-help
da-help: ## Show dev-agents commands
	@echo ""
	@echo "dev-agents commands:"
	@grep -hE '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-12s\033[0m %s\n", $$1, $$2}'
	@echo ""
